<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>contribuer</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="nav">
        <div class="nav-title">
            <h1>MOUHTA RANDO</h1>
            <p>Voyage au coeur de la nature</p>
        </div>
        <ul>
            <li><a href="/">Randonner</a></li>
            <li><a href="/contribuer">Contribuer</a></li>
            <li id="navbar"></li>


        </ul>
    </nav>
   

       
     <div class="create-hike content">
        <form id="hikeForm" action="http://localhost:3000/contribuer" enctype="multipart/form-data" method="POST">
            <label for="nom">Nom de la randonnée:</label>
            <input type="text" id="title" name="nom" required>
            <label for="depart">Adresse du point de départ:</label>
            <input type="text" id="snippet" name="depart" required> 
            <label for="score">Score de popularité:</label>
            <input type="text" id="score" name="score" required> 
            <label for="description">Description de la randonnée:</label>
            <textarea id="body" name="description" required></textarea>
            
            <input type="file" name="file" id="files" multiple>
            <button type="submit">Submit</button>
        </form>
    </div>

    <script>
        const link = document.createElement('a');
        link.href = "/connexion";
        link.textContent = "Connexion";
        document.getElementById("navbar").appendChild(link);
    
    const form = document.querySelector('form');
form.addEventListener('submit', (e) => {
    e.preventDefault(); // Prevents HTML handling submission

    const nom = document.getElementById('title').value;
    const depart = document.getElementById('snippet').value;
    const description = document.getElementById('body').value;
    const score = document.getElementById('score').value;
    const files = document.getElementById("files").files; // Access files

    const formData = new FormData(); // Create FormData object
    formData.append('nom', nom); // Append form fields
    formData.append('depart', depart);
    formData.append('description', description);
    formData.append('score', score);

    // Append files
    for (let i = 0; i < files.length; i++) {
        formData.append('files', files[i]);
    }

    // Post data to Node and Express server:
    fetch('http://localhost:3000/contribuer', {
        method: 'POST',
        body: formData // Send FormData object directly
    })
    .then(res => {
        if (res.redirected) {
            // Redirect to the index page
            window.location.href = res.url;
        } else {
            // Handle other responses here
            return res.json();
        }
    })
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
});
fetch('/api/contribuer-data')
      .then(response => response.json())
      .then(data => {
        if(data.connected===1)
            {
                const navbar = document.getElementById("navbar");
                navbar.innerHTML = ''; 
                const newLink = document.createElement('a');
                newLink.textContent = data.identifiant;
                navbar.appendChild(newLink);
                    
            }
      })
      .catch(error => console.error('Error fetching data:', error));

    </script>
    
   
    
    
    <footer>
        Copyright &copy; Mouhta Rando 2024
    </footer>
  
</body>

</html>